%load imgregdata.mat % I do it via terminal
%left and above neighbours
get_neighbours = @(x) [x(:, 1032)'; x(:, 1032 - 34)']';

%prepare training set
X_tr = get_neighbours(xtr_nf);
%train (it will add bias term automatically)
[w, predictor] = lr_predictor(X_tr, ytr_nf);
display(w, 'weights for neighbours pixels features');

%predicted y on the training set
Yp_tr = predictor(X_tr);
%display training error
error_tr = rmse(ytr_nf, Yp_tr);
display(error_tr, 'rmse on the training set');

%prepare testing set
X_te = get_neighbours(xte_nf);
%predicted y on the test set
Yp_te = predictor(X_te);
%display test error
error_te = rmse(yte_nf, Yp_te);
display(error_te, 'rmse on the test set');

%show surface
figure,
[dim1, dim2] = meshgrid(0:0.01:1,0:0.01:1);
ysurf = [[dim1(:), dim2(:)], ones(numel(dim1),1)]*w;
surf(dim1, dim2, reshape(ysurf, size(dim1)))