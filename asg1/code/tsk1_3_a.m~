%launch via 
%tsk1_3_a(xtr_nf, ytr_nf, 5:5:30)
%and
%tsk1_3_a(xtr_nf, ytr_nf, 1:20)
function [] = tsk1_3_a(x_all, t, num_rbfs)
    %t - means target values
    get_adjacent_pixels = @(x) [x(1:17260, 1032), x(1:17260, 1032 - 34)];
    
    t = t(1:17260);
    x = get_adjacent_pixels(x_all);
    
    opt = foptions;
    opt(1)  = 1; % Display EM training
    opt(14) = 5; % number of iterations of EM
    dim     = 2; % left_pixel, above_pixel in our case
    
    function regf = create_rbf_regf(num_rbf)
        function result = rbf_reg(x_train, t_train, x_test, t_test)
            net = rbf(dim, num_rbf, 1, 'gaussian');
            net = rbftrain(net, opt, x_train, t_train);
            y_test = rbffwd(net, x_test);
            result = (y_test - t_test).^2;
        end
        regf = @rbf_reg;
    end
    
    errors = zeros(1, length(num_rbfs));
    
    for i = 1:length(num_rbfs)
        num_rbf = num_rbfs(i);
        regf = create_rbf_regf(num_rbf);
        %default CV 10 folds 
        %cvMse = crossval('mse', x, t,'predfun',regf);
        sqr_res = crossval(regf, x, t(1:17260));
        S = numel(sqr_res);
        sqr_res = reshape(sqr_res, [1, S]);
        mse = mean(sqr_res);
        std_error = var(sqr_res)/S
        errors(i) = cvMse ^ 0.5;
    end
    
    plot(num_rbfs, errors)
    hold on;
    plot(num_rbfs, errors, 'r*');
    xlabel('number of rbf used');
    ylabel('Root Mean Square Error');
    set(gca,'FontSize', 18);
end